app-id: net.damonlynch.rapid_photo_downloader
runtime: org.kde.Platform
runtime-version: "5.15-22.08"
sdk: org.kde.Sdk
base: com.riverbankcomputing.PyQt.BaseApp
base-version: "5.15-22.08"
command: rapid-photo-downloader
finish-args:
  - "--share=ipc"
  - "--socket=wayland"
  - "--socket=fallback-x11"
  - "--socket=pulseaudio"
  - "--share=network"
  - "--device=all"
  - "--device=dri"
  - "--filesystem=host"
  - "--filesystem=xdg-download"
  - "--talk-name=org.freedesktop.Notifications"
  - "--talk-name=org.kde.StatusNotifierWatcher"
  - "--talk-name=org.freedesktop.portal.FileChooser"
  - "--talk-name=com.canonical.AppMenu.Registrar"
  - "--talk-name=com.canonical.Unity"
  - "--talk-name=com.canonical.indicator.application"
  - "--talk-name=org.ayatana.indicator.application"
  - "--unset-env=XDG_DATA_HOME"
  - "--env=QT_PLUGIN_PATH=/app/lib64/plugins:/app/lib/plugins"
  - "--env=QTWEBENGINEPROCESS_PATH=/app/bin/QtWebEngineProcess"
  - "--env=PERL5LIB=/app/lib/perl5/site_perl/5.36.0/"
  - "--system-talk-name=org.freedesktop.UDisks2"
  - "--talk-name=org.freedesktop.DBus.Introspectable.*"

cleanup:
  - /include
  - /lib/pkgconfig
  - "/bin/gphoto2*"
  - "/doc"
  - "/lib/cmake"
  - "/lib/pkgconfig"
  - "/lib/girepository-*"
  - "/man"
  - "/share/doc"
  - "/share/gtk-doc/html/libosmgpsmap"
  - "/share/man"
  - "*.a"
  - "*.la"


modules:
  - shared-modules/intltool/intltool-0.51.json
  - shared-modules/gudev/gudev.json

  - name: libnotify
    buildsystem: meson
    config-opts:
      - -Dgtk_doc=false
      - -Dman=false
    sources:
      - type: archive
        url: https://download.gnome.org/sources/libnotify/0.7/libnotify-0.7.9.tar.xz
        sha256: 66c0517ed16df7af258e83208faaf5069727dfd66995c4bbc51c16954d674761
        x-checker-data:
          type: anitya
          project-id: 13149
          url-template: https://download.gnome.org/sources/libnotify/$major.$minor/libnotify-$version.tar.xz



  - name: exiftool
    buildsystem: simple
    build-commands:
      - perl-libs/install.sh
    cleanup:
      - "/man"
    post-install:
      - "chmod -Rf u+w ${FLATPAK_DEST}/lib/perl5/site_perl"
    sources:
      - exiftool-sources.json
 

  - name: exiv2
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DEXIV2_BUILD_DOC:BOOL=OFF
      - -DEXIV2_BUILD_EXIV2_COMMAND=OFF
      - -DEXIV2_ENABLE_BMFF=ON
      - -DEXIV2_BUILD_SAMPLES=OFF
    sources:
      - type: archive
        url: https://github.com/Exiv2/exiv2/releases/download/v0.27.6/exiv2-0.27.6-Source.tar.gz
        sha256: 4c192483a1125dc59a3d70b30d30d32edace9e14adf52802d2f853abf72db8a6

# gphoto
  - name: libgphoto2
    sources:
      - type: archive
        url: https://github.com/gphoto/libgphoto2/releases/download/v2.5.30/libgphoto2-2.5.30.tar.bz2
        sha256: ee61a1dac6ad5cf711d114e06b90a6d431961a6e7ec59f4b757a7cd77b1c0fb4

  - name: python3-psutil
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "psutil>=3.4.2" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/d6/0f/96b7309212a926c1448366e9ce69b081ea79d63265bde33f11cc9cfc2c07/psutil-5.9.5.tar.gz
        sha256: 5410638e4df39c54d957fc51ce03048acd8e6d60abc0f5107af51e5fb566eb3c

  - name: python3-gphoto2
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "gphoto2>=1.8.0" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/fd/ca/ffba45e163799fba74af20ea6b5dd1f74e95f3b3c48e2a6239d9155c5eb7/gphoto2-2.3.6.tar.gz
        sha256: e35b62f0cc44d6c3ef1d611a9a85b611b4841442eb8ecc9ee2ffca835dd956c9

  - name: python3-pyzmq
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "pyzmq>=16.0.2" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/3f/7c/69d31a75a3fe9bbab349de7935badac61396f22baf4ab53179a8d940d58e/pyzmq-25.1.1.tar.gz
        sha256: 259c22485b71abacdfa8bf79720cd7bcf4b9d128b30ea554f01ae71fdbfdaa23

  - name: python3-pyxdg
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "pyxdg>=0.25" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/e5/8d/cf41b66a8110670e3ad03dab9b759704eeed07fa96e90fdc0357b2ba70e2/pyxdg-0.28-py2.py3-none-any.whl
        sha256: bdaf595999a0178ecea4052b7f4195569c1ff4d344567bccdc12dfdf02d545ab
        
  - name: python3-arrow
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "arrow>=0.9.0" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/67/67/4bca5a595e2f89bff271724ddb1098e6c9e16f7f3d018d120255e3c30313/arrow-1.2.3-py3-none-any.whl
        sha256: 5a49ab92e3b7b71d96cd6bfcc4df14efefc9dfa96ea19045815914a6ab6b1fe2
      - type: file
        url: https://files.pythonhosted.org/packages/36/7a/87837f39d0296e723bb9b62bbb257d0355c7f6128853c78955f57342a56d/python_dateutil-2.8.2-py2.py3-none-any.whl
        sha256: 961d03dc3453ebbc59dbdea9e4e11c5651520a876d0f4db161e8674aae935da9
  - name: python3-easygui
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "easygui>=0.98.1" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/8e/a7/b276ff776533b423710a285c8168b52551cb2ab0855443131fdc7fd8c16f/easygui-0.98.3-py2.py3-none-any.whl
        sha256: 33498710c68b5376b459cd3fc48d1d1f33822139eb3ed01defbc0528326da3ba
  - name: python3-colour
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "colour" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/74/46/e81907704ab203206769dee1385dc77e1407576ff8f50a0681d0a6b541be/colour-0.1.5-py2.py3-none-any.whl
        sha256: 33f6db9d564fadc16e59921a56999b79571160ce09916303d35346dddc17978c
  - name: python3-pymediainfo
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "pymediainfo>=2.2.0" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/72/dc/549fc39fbeb6907dc2ef2fa96cad9eea39bac043f4ce56efe243c926480f/pymediainfo-6.0.1.tar.gz
        sha256: 96e04bac0dfcb726bed70c314b1219121c4b9344c66a98f426ce27d7f9abffb0
  - name: python3-sortedcontainers
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "sortedcontainers" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/32/46/9cb0e58b2deb7f82b84065f37f3bffeb12413f947f9388e4cac22c4621ce/sortedcontainers-2.4.0-py2.py3-none-any.whl
        sha256: a163dcaede0f1c021485e957a39245190e74249897e2ae4b2aa38595db237ee0
  - name: python3-tornado
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "tornado" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/48/64/679260ca0c3742e2236c693dc6c34fb8b153c14c21d2aa2077c5a01924d6/tornado-6.3.3.tar.gz
        sha256: e7d8db41c0181c80d76c982aacc442c0783a2c54d6400fe028954201a2e032fe



  - name: python3-pycairo
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "pycairo" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/a2/dd/bc2c9ee9485308a29c18b1241329e677917af25c60b127857f0fb23d0c6e/pycairo-1.24.0.tar.gz
        sha256: 1444d52f1bb4cc79a4a0c0fe2ccec4bd78ff885ab01ebe1c0f637d8392bcafb6

  - name: python3-PyGObject
    buildsystem: simple
    build-commands: 
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "PyGObject" --no-build-isolation
    sources:
    - type: file
      url: https://files.pythonhosted.org/packages/44/80/96d6317a15a13a4f80ffa61118dc144a70756135fbc6ace30f9b033f51f7/PyGObject-3.44.1.tar.gz
      sha256: 665fbe980c91e8b31ad78ed3f66879946948200864002d193f67eccc1d7d5d83
    - type: file
      url: https://files.pythonhosted.org/packages/a2/dd/bc2c9ee9485308a29c18b1241329e677917af25c60b127857f0fb23d0c6e/pycairo-1.24.0.tar.gz
      sha256: 1444d52f1bb4cc79a4a0c0fe2ccec4bd78ff885ab01ebe1c0f637d8392bcafb6

  - name: python3-Babel
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "Babel" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/df/c4/1088865e0246d7ecf56d819a233ab2b72f7d6ab043965ef327d0731b5434/Babel-2.12.1-py3-none-any.whl
        sha256: b4246fb7677d3b98f501a39d43396d3cafdc8eadb045f4a31be01863f655c610

  - name: python3-show-in-file-manager
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "show-in-file-manager>=1.1.2" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/ab/c3/57f0601a2d4fe15de7a553c00adbc901425661bf048f2a22dfc500caf121/packaging-23.1-py3-none-any.whl
        sha256: 994793af429502c4ea2ebf6bf664629d07c1a9fe974af92966e4b8d2df7edc61
      - type: file
        url: https://files.pythonhosted.org/packages/e5/8d/cf41b66a8110670e3ad03dab9b759704eeed07fa96e90fdc0357b2ba70e2/pyxdg-0.28-py2.py3-none-any.whl
        sha256: bdaf595999a0178ecea4052b7f4195569c1ff4d344567bccdc12dfdf02d545ab
      - type: file
        url: https://files.pythonhosted.org/packages/68/82/37f378b219d5700effecbf3b60316af3c770e6ea3de0a4c05feafa4c4317/show_in_file_manager-1.1.4-py3-none-any.whl
        sha256: ccfbf212866b70f94e6e8bc1d7acf6bf0ad4447ff7dca50e7a64573b59e1a2c9

  - name: python3-pycparser
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "pycparser" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/py2.py3/p/pycparser/pycparser-2.21-py2.py3-none-any.whl
        sha256: 8ee45429555515e1f6b185e78100aea234072576aa43ab53aefcae078162fca9


  - name: python3-cffi
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "." --no-build-isolation
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/source/c/cffi/cffi-1.15.1.tar.gz
        sha256: d400bfb9a37b1351253cb402671cea7e89bdecc294e8016a707f6d1d8ac934f9
    x-checker-data:
      type: pypi
      name: cffi


  - name: python3-pyheif
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "pyheif" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/3e/8b/905c7b3dcd5405ddb582a67334eef9f3259108816547cb0bf3c213c2d821/pyheif-0.7.1-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl
        sha256: 99c4df0588f65c1e4bb2a184338980e4810b70641f1df6414841c089f8273175



# for apple devices
  - name: plist
    cleanup:
      - /bin
      - /include
      - /lib/libplist++*
      - /lib/pkgconfig
      - /share/man
      - '*.la'
    config-opts:
      - --without-cython
      - --disable-static
    sources:
      - type: archive
        url: "https://github.com/libimobiledevice/libplist/releases/download/2.2.0/libplist-2.2.0.tar.bz2"
        sha256: 4a5517e5377ec421df84c586ba85bb4e1d26f11ad203d7d450a907c0156fbd9a

  - name: LibRaw
    config-opts:
      - --disable-examples
      - --disable-static
    sources:
      - type: archive
        url: https://www.libraw.org/data/LibRaw-0.21.1.tar.gz
        sha256: 630a6bcf5e65d1b1b40cdb8608bdb922316759bfb981c65091fec8682d1543cd
    cleanup:
      - /bin

  - shared-modules/intltool/intltool-0.51.json

# a reaactiver pour le support des videos
  # - gstreamer.json


  - name: rapid-photo-downloader
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=${FLATPAK_DEST} .
    sources:
      - type: git
        url: https://github.com/damonlynch/rapid-photo-downloader
        branch: main



       #rapid-photo-downloader --detailed-version

# Exporting share/applications/net.damonlynch.rapid_photo_downloader.desktop
# Not exporting share/icons/hicolor/128x128/apps/rapid-photo-downloader.png, non-allowed export filename
# Not exporting share/icons/hicolor/16x16/apps/rapid-photo-downloader.png, non-allowed export filename
# Not exporting share/icons/hicolor/22x22/apps/rapid-photo-downloader.png, non-allowed export filename
# Not exporting share/icons/hicolor/24x24/apps/rapid-photo-downloader.png, non-allowed export filename
# Not exporting share/icons/hicolor/256x256/apps/rapid-photo-downloader.png, non-allowed export filename
# Not exporting share/icons/hicolor/48x48/apps/rapid-photo-downloader.png, non-allowed export filename
# Not exporting share/icons/hicolor/512x512/apps/rapid-photo-downloader.png, non-noallowed export filename
# Not exporting share/icons/hicolor/64x64/apps/rapid-photo-downloader.png, non-allowed export filename
# Not exporting share/icons/hicolor/scalable/apps/rapid-photo-downloader.svg, non-allowed export filename
# Not exporting share/appdata/com.riverbankcomputing.PyQt.BaseApp.appdata.xml, non-allowed export filename
# Not exporting share/appdata/io.qt.qtwebengine.BaseApp.appdata.xml, non-allowed export filename
# Exporting share/appdata/net.damonlynch.rapid_photo_downloader.appdata.xml

# WARNING: Icon not matching app id in /var/home/yodatak/Projets/worktest/rapid-photo-downloader/flatpakbuild/export/share/applications/net.damonlynch.rapid_photo_downloader.desktop: rapid-photo-downloader
# WARNING: Icon referenced in desktop file but not exported: rapid-photo-downloader
